### Events

Hybris Event Framework — это мощный и гибкий механизм в SAP, который позволяет управлять и запускать события в ответ на действия или условия.
Эти события можно использовать для расширения и настройки функциональности платформы в соответствии с конкретными бизнес-требованиями.
События — это способ общения между компонентами программного обеспечения.
Источники испускают события, и каждая сторона регистрирует слушателей, которые могут получать эти события и выполнять логику.

События предназначены для обмена информацией между слабосвязанными компонентами. Система событий Hybris основана на фреймворке событий Spring.
События Hybris позволяют нам публиковать и прослушивать определенные события для выполнения бизнес-логики в зависимости от произошедшего события.
События могут публиковаться как локально, так и на узлах кластера, содержит необходимые данные для передачи в EventListener.

Системные события: это предопределенные события, генерируемые Hybris в ответ на действия на системном уровне, такие как создание, изменение или удаление объекта.

Пользовательские события: Разработчики могут определять пользовательские события, соответствующие их конкретным потребностям.
Эти события могут быть вызваны из пользовательских расширений или других частей системы.

Event содержит необходимые данные для передачи в EventListener. Он определяется классом, который расширяет AbstractEvent.

События хорошо использовать, когда мы хотим передать обработку другому потоку.
Мы используем событие для менее приоритетной задачи или долговременной задачи или чего-то,
что может быть выполнено параллельно отдельным потоком от основного потока.

Например: Задача с низким приоритетом. Выполнение задачи занимает много времени. Задачу следует запустить в отдельном потоке от основного потока.
Отправлять электронные письма, отправка отчета на сторонний сервер, сохранять данные журнала, сохранять данные аудита…
Способствует разделению задач, позволяя различным частям системы реагировать на изменения без прямых зависимостей.
Поддерживает асинхронную обработку и обработку кластерных событий, повышая масштабируемость систем с высоким трафиком.
События могут публиковаться транзакционно, гарантируя, что прослушиватели будут действовать только в случае успеха транзакций, предотвращая несогласованность.
Можно добавлять пользовательские события и прослушиватели для поддержки уникальных бизнес-процессов и расширения функциональности платформы.

### EventListener
Слушатели событий: Это компоненты или службы, которые подписываются на определенные события.
Когда происходит событие, все зарегистрированные слушатели этого события уведомляются, что позволяет им соответствующим образом реагировать.

Типы прослушивателей: прослушиватели могут быть реализованы как компоненты Spring или как аспекты AspectJ,
что обеспечивает гибкость в структурировании логики обработки событий.

Классы прослушивателей событий: реализуйте EventListener<T> для обработки типов событий. Spring Beans и аннотации.
Слушателями часто являются Spring bean-компоненты, подписывающиеся на события.
Hybris использует аннотации Spring для объявления слушателей и привязки их к конкретным событиям.

EventListener будет прослушивать событие-триггер и запускать бизнес-логику, которая определена внутри метода onEvent(event).
Самый простой способ создать слушателя событий — расширить класс AbstractEventListener и переопределить его метод onEvent().

События обычно публикуются в коде с помощью Hybris Event Service.
Разработчики могут указать тип события и любые необходимые данные для включения в событие.

События также могут быть вызваны действиями системы, например, при сохранении определенного объекта или при выполнении бизнес-процессов.
Опубликовать событие нужно вызвать метод publishEvent(event) класса EventService с экземпляром события с экземпляром ExpertHybrisEvent.

Перехватчики могут прерывать жизненный цикл модели и выполнять некоторую логику.
Перехватчики работают до сохранения в базе данных. Но иногда нам требуется выполнить бизнес-операцию после сохранения любой модели.
После каждой операции с базой данных (независимо от того, вызвана ли она зафиксированной транзакцией или нет) Hybris создает одно событие.
Это событие содержит информацию об элементе, который был добавлен или обновлен. Мы можем собирать эти события и выполнять нашу бизнес-логику.

Класс AfterSaveEvent, который содержит PK измененного элемента и тип операции базы данных. Это может быть CREATE, UPDATE или REMOVE.
Мы можем собирать эти события и выполнять нашу логику с помощью реализации нашего слушателя с использованием интерфейса AfterSaveListener.

Слушатели событий отвечают за определение логики, которая должна быть выполнена при возникновении определенного события.
Это может включать обновление данных, запуск других процессов или отправку уведомлений.

Обработка событий может быть синхронной или асинхронной, в зависимости от варианта использования.
Асинхронная обработка может быть полезна для выгрузки трудоемких задач из основного потока приложения.

Слушатель может быть уведомлен о вновь созданных событиях в двух режимах: синхронном и асинхронном. Асинхронный режим включен по умолчанию.
Мы можем включить синхронный режим, используя указанные ниже свойства. Мы добавим эти свойства в local.properties.core.aftersave.async=false

Все слушатели уведомляются с помощью одного и того же набора событий. Нам нужно создать слушателя для сбора определенных событий и обработки бизнес-логики.
Для создания пользовательского слушателя нам нужно реализовать интерфейс AfterSaveListener и переопределить метод afterSave. Реализации по умолчанию нет.

События и слушатели

Система событий — это структура, предоставляемая ServiceLayer, которая позволяет отправлять и получать события в SAP Commerce.

Вы можете настроить компоненты вашего расширения для публикации событий, которые затем будут получены зарегистрированными слушателями.
Слушатели — это объекты, которые уведомляются о событиях и выполняют бизнес-логику в зависимости от произошедшего события.
События могут быть опубликованы локально или в кластере узлов. Вы можете зарегистрировать новых слушателей как Spring-бины в вашем XML-файле конфигурации Spring.

Платформа определяет и публикует события для ряда предопределенных типов событий.
К ним относится тип AfterItemCreationEvent, элементы которого публикуются после сохранения любого нового элемента данных в базе данных.
Для обработки этих событий AfterItemCreationEvent вы предоставляете класс слушателя и регистрируете его в фреймворке событий.

Для вашего расширения вы хотите генерировать элементы новостей, которые вы можете отправлять зарегистрированным подписчикам через различные каналы.
Вы хотите создавать новый элемент новостей всякий раз, когда подписывается новая группа.
В вашем классе слушателя вы переопределяете метод onEvent , чтобы указать код, который вы хотите выполнить, когда происходит это событие.
В этом случае вы проверяете, является ли новый элемент группой.
Если это так, вы просите службу модели платформы создать и сохранить новый элемент новостей.

